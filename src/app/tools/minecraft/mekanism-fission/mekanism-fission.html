<div class="container">
  <div class="head-content-centered">
    <h1>Mekanism Fission Reactor Calculator</h1>
    <p>Calculate materials, power output, and water recycling requirements</p>
  </div>

  <div class="content">
    <h2>Reactor Configuration</h2>
    
    <div class="calculator-form">
      <h3>Reactor Dimensions</h3>
      
      <div class="form-row">
        <div class="form-group">
          <label for="reactorWidth">
            <strong>Width:</strong>
          </label>
          <input
            type="number"
            id="reactorWidth"
            [(ngModel)]="reactorWidth"
            min="3"
            max="18"
            class="form-input"
          />
          <p class="form-help">Reactor width (3-18 blocks)</p>
        </div>

        <div class="form-group">
          <label for="reactorHeight">
            <strong>Height:</strong>
          </label>
          <input
            type="number"
            id="reactorHeight"
            [(ngModel)]="reactorHeight"
            min="4"
            max="18"
            class="form-input"
          />
          <p class="form-help">Reactor height (4-18 blocks)</p>
        </div>

        <div class="form-group">
          <label for="reactorLength">
            <strong>Length:</strong>
          </label>
          <input
            type="number"
            id="reactorLength"
            [(ngModel)]="reactorLength"
            min="3"
            max="18"
            class="form-input"
          />
          <p class="form-help">Reactor length (3-18 blocks)</p>
        </div>
      </div>

      <h3>Reactor Settings</h3>

      <div class="form-group info-group">
        <label>
          <strong>Fuel Assemblies (Auto-calculated):</strong>
        </label>
        <div class="info-value">{{ getCalculatedFuelAssemblies() }} assemblies</div>
        <p class="form-help">
          Fuel assemblies fill the entire reactor interior volume ((width-2) × (height-2) × (length-2))
        </p>
      </div>

      <div class="form-group">
        <label for="burnRate">
          <strong>Burn Rate:</strong>
        </label>
        <input
          type="number"
          id="burnRate"
          [(ngModel)]="burnRate"
          min="0.1"
          max="10"
          step="0.1"
          class="form-input"
        />
        <p class="form-help">Reactor burn rate (0.1-10 mB/t per assembly)</p>
      </div>

      <div class="form-group">
        <label for="coolantType">
          <strong>Coolant Type:</strong>
        </label>
        <select id="coolantType" [(ngModel)]="coolantType" class="form-input">
          <option value="water">Water</option>
          <option value="sodium">Sodium (5x steam production)</option>
        </select>
        <p class="form-help">Choose reactor coolant type</p>
      </div>

      <h3 *ngIf="coolantType === 'sodium'">Boiler Configuration</h3>

      <div *ngIf="coolantType === 'sodium'">
        <div class="form-row">
          <div class="form-group">
            <label for="boilerWidth">
              <strong>Boiler Width:</strong>
            </label>
            <input
              type="number"
              id="boilerWidth"
              [(ngModel)]="boilerWidth"
              min="3"
              max="18"
              class="form-input"
            />
            <p class="form-help">Boiler width (3-18 blocks)</p>
          </div>

          <div class="form-group">
            <label for="boilerHeight">
              <strong>Boiler Height:</strong>
            </label>
            <input
              type="number"
              id="boilerHeight"
              [(ngModel)]="boilerHeight"
              min="4"
              max="18"
              class="form-input"
            />
            <p class="form-help">Boiler height (4-18 blocks)</p>
          </div>
        </div>

        <div class="form-group">
          <label for="superheatingElements">
            <strong>Superheating Elements:</strong>
          </label>
          <input
            type="number"
            id="superheatingElements"
            [(ngModel)]="superheatingElements"
            min="1"
            [max]="getMaxSuperheaters()"
            class="form-input"
          />
          <p class="form-help">
            Number of superheating elements (each processes 100,000 mB/t sodium)
          </p>
        </div>
      </div>

      <h3>Turbine Configuration</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="turbineWidth">
            <strong>Turbine Width:</strong>
          </label>
          <input
            type="number"
            id="turbineWidth"
            [(ngModel)]="turbineWidth"
            min="5"
            max="17"
            class="form-input"
          />
          <p class="form-help">Width & Length (5-17 blocks)</p>
        </div>

        <div class="form-group">
          <label for="turbineHeight">
            <strong>Turbine Height:</strong>
          </label>
          <input
            type="number"
            id="turbineHeight"
            [(ngModel)]="turbineHeight"
            min="5"
            max="18"
            class="form-input"
          />
          <p class="form-help">Turbine height (5-18 blocks)</p>
        </div>
      </div>

      <div class="form-group info-group">
        <label>
          <strong>Rotors (Auto-calculated):</strong>
        </label>
        <div class="info-value">{{ getCalculatedRotors() }} rotors</div>
        <p class="form-help">
          Rotors limited by min(height-2, 2×width-1, 10 max). Each rotor holds 2 blades (max 20 total). Optimal blades = coils × 4.
        </p>
      </div>

      <div class="form-group">
        <label for="electromagneticCoils">
          <strong>Electromagnetic Coils:</strong>
        </label>
        <input
          type="number"
          id="electromagneticCoils"
          [(ngModel)]="electromagneticCoils"
          min="1"
          [max]="getMaxCoils()"
          class="form-input"
        />
        <p class="form-help">
          Number of coils (max {{ getMaxCoils() }} for turbine size)
        </p>
      </div>

      <h3>Additional Options</h3>

      <div class="form-group">
        <label for="powerUnit">
          <strong>Power Unit:</strong>
        </label>
        <select
          id="powerUnit"
          [(ngModel)]="powerUnit"
          class="form-input"
        >
          <option value="FE">FE (Forge Energy)</option>
          <option value="RF">RF (Redstone Flux)</option>
          <option value="AE">AE (Applied Energistics - 1 AE = 2 FE)</option>
        </select>
        <p class="form-help">Choose power unit for display</p>
      </div>

      <div class="form-group checkbox-group">
        <label>
          <input
            type="checkbox"
            [(ngModel)]="enableWaterRecycling"
            class="form-checkbox"
          />
          <strong>Enable Water Recycling System</strong>
        </label>
        <p class="form-help">Calculate required fluid pipes and saturating condensers</p>
      </div>

      <div class="button-group">
        <button (click)="calculate()" class="btn btn-primary">Calculate</button>
        <button (click)="reset()" class="btn btn-secondary">Reset</button>
      </div>
    </div>
  </div>

  @if (results) {
    <div class="content">
      <h2>Results</h2>
      
      <div class="results-grid">
        <div class="result-card">
          <h3>Reactor Components</h3>
          <ul class="result-list">
            <li>
              <span class="result-label">Fuel Assemblies:</span>
              <span class="result-value">{{ results.fuelAssemblies }}</span>
            </li>
            <li>
              <span class="result-label">Control Rods:</span>
              <span class="result-value">{{ results.controlRods }}</span>
            </li>
            <li>
              <span class="result-label">Reactor Casings:</span>
              <span class="result-value">{{ results.reactorCasings }}</span>
            </li>
            <li>
              <span class="result-label">Reactor Glass:</span>
              <span class="result-value">{{ results.reactorGlass }}</span>
            </li>
          </ul>
        </div>

        <div class="result-card">
          <h3>Power & Production</h3>
          <ul class="result-list">
            <li *ngIf="results.sodiumProduction > 0">
              <span class="result-label">Sodium Production:</span>
              <span class="result-value">{{ results.sodiumProduction }} mB/t</span>
            </li>
            <li>
              <span class="result-label">Steam Production:</span>
              <span class="result-value">{{ results.steamProduction }} mB/t</span>
            </li>
            <li>
              <span class="result-label">Turbines Needed:</span>
              <span class="result-value">{{ results.turbinesNeeded }}</span>
            </li>
            <li>
              <span class="result-label">Steam per Turbine:</span>
              <span class="result-value">{{ results.steamPerTurbine }} mB/t</span>
            </li>
            <li>
              <span class="result-label">Max Steam Flow (per turbine):</span>
              <span class="result-value">{{ results.maxSteamFlow }} mB/t</span>
            </li>
            <li>
              <span class="result-label">Blade Rate:</span>
              <span class="result-value">{{ results.bladeRate }}%</span>
            </li>
            <li>
              <span class="result-label">Power Generation (total):</span>
              <span class="result-value">{{ results.powerGeneration }} {{ getPowerUnitLabel() }}</span>
            </li>
            <li>
              <span class="result-label">Water Consumption:</span>
              <span class="result-value">{{ results.waterConsumption }} mB/t</span>
            </li>
          </ul>
        </div>

        <div class="result-card">
          <h3>Turbine Components ({{ results.turbineSize }})</h3>
          <ul class="result-list">
            <li>
              <span class="result-label">Rotors:</span>
              <span class="result-value">{{ results.turbineRotors }}</span>
            </li>
            <li>
              <span class="result-label">Turbine Blades:</span>
              <span class="result-value">{{ results.turbineBlades }}</span>
            </li>
            <li>
              <span class="result-label">Electromagnetic Coils:</span>
              <span class="result-value">{{ results.turbineCoils }}</span>
            </li>
            <li>
              <span class="result-label">Dispersers:</span>
              <span class="result-value">{{ results.turbineDispersers }}</span>
            </li>
            <li>
              <span class="result-label">Saturating Vents:</span>
              <span class="result-value">{{ results.turbineVents }}</span>
            </li>
            <li>
              <span class="result-label">Structural Glass:</span>
              <span class="result-value">{{ results.structuralGlass }}</span>
            </li>
          </ul>
        </div>

        @if (results.boilersNeeded > 0) {
          <div class="result-card">
            <h3>Boiler Components (Sodium Cooling)</h3>
            <ul class="result-list">
              <li>
                <span class="result-label">Boilers Needed:</span>
                <span class="result-value">{{ results.boilersNeeded }}</span>
              </li>
              <li>
                <span class="result-label">Superheating Elements:</span>
                <span class="result-value">{{ results.superheatingElements }}</span>
              </li>
              <li>
                <span class="result-label">Water Capacity (per boiler):</span>
                <span class="result-value">{{ results.boilerWaterCapacity }} mB</span>
              </li>
              <li>
                <span class="result-label">Steam Capacity (per boiler):</span>
                <span class="result-value">{{ results.boilerSteamCapacity }} mB</span>
              </li>
            </ul>
            <p class="form-help">
              Boilers convert superheated sodium from reactor into steam for turbines
            </p>
          </div>
        }

        @if (enableWaterRecycling) {
          <div class="result-card">
            <h3>Water Recycling System</h3>
            <ul class="result-list">
              <li>
                <span class="result-label">Ultimate Fluid Pipes:</span>
                <span class="result-value">{{ results.ultimateFluidPipes }}</span>
              </li>
              <li>
                <span class="result-label">Saturating Condensers:</span>
                <span class="result-value">{{ results.saturatingCondensers }}</span>
              </li>
            </ul>
            <p class="form-help">
              These components will recycle steam back to water for continuous operation
            </p>
          </div>
        }
      </div>
    </div>
  }

  <div class="content">
    <h2>About This Calculator</h2>
    <p>
      This calculator helps you plan your Mekanism fission reactor setup. It calculates:
    </p>
    <ul>
      <li><strong>Reactor Components:</strong> Auto-calculated fuel assemblies based on reactor size, control rods, and construction materials</li>
      <li><strong>Coolant Systems:</strong> Water cooling (direct steam) or Sodium cooling (requires thermoelectric boiler)</li>
      <li><strong>Boiler Requirements:</strong> Number of boilers and superheating elements needed for sodium cooling</li>
      <li><strong>Turbine Setup:</strong> Number of turbines needed when reactor output exceeds single turbine capacity</li>
      <li><strong>Power Output:</strong> Expected power generation with selectable units (FE/RF/AE)</li>
      <li><strong>Water Recycling:</strong> Required ultimate fluid pipes and saturating condensers for continuous operation</li>
    </ul>
    <p>
      <strong>Fuel assemblies</strong> are automatically calculated to fill the entire reactor interior volume.
      For <strong>sodium cooling</strong>, a thermoelectric boiler is required to convert superheated sodium into steam.
      When water recycling is enabled, the calculator determines the minimum number of
      saturating condensers needed to convert all produced steam back into water, and the
      number of ultimate fluid pipes required to transport the fluids efficiently.
    </p>
  </div>

  <div class="content">
    <p><a routerLink="/tools/minecraft">← Back to Minecraft Tools</a></p>
  </div>
</div>
